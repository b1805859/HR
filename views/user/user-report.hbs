<!-- Content wrapper -->
<div class="content-wrapper">
  <!-- Content -->

  <div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-1 mb-3"><span class="text-muted fw-light">Chấm công /</span> Lịch sử chấm công</h4>

    <nav id="navbar-acupuncture" class="navbar bg-light mb-2">
      <div class=" col-md-5 p-3">
        <label for="months" class="form-label">Tháng</label>
        <select id="months" name="months" class="select2 form-select">
          <option value="">--Chọn--</option>
        </select>
      </div>
    </nav>
    <!-- Responsive Table -->
    <div id="card" class="card">
      <div class="table-responsive text-nowrap">
        <table class="table table-bordered">
          <thead>
            <tr id="title_month" class="text-nowrap">
            </tr>
          </thead>
          <tbody>
            <tr id="acupuncture_user">
              <td>{{employee.code}}</td>
              <td>{{employee.name}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!--/ Responsive Table -->

    <!--/ Basic Pagination -->
  </div>
  <!-- / Content -->

  <!-- Modal HTML -->
  <!-- Content wrapper -->
  <script>
    var msg = "{{ msgError }}"
    if (msg) {
      var h1 = `<h3 class="text-center mt-5 p-5">${msg}</h3>`
      $('#card').prepend(h1)
      $('#acupuncture_user').html('')
      $('#navbar-acupuncture').hide()
    }
    else {

      var html = "<th>Mã nhân viên</th><th>Tên nhân viên</th>"
      var acupuncture = "";
      var month_encode = "{{ month }}"
      var months_encode = "{{ months }}"
      var acupunctures_encode = "{{ acupunctures }}"
      var month = JSON.parse(month_encode.replace(/&quot;/ig, '"'));
      var months = JSON.parse(months_encode.replace(/&quot;/ig, '"'));
      var acupunctures = JSON.parse(acupunctures_encode.replace(/&quot;/ig, '"'));
      var h1 = `<h1 class="text-center mt-4 mb-2">Tháng ${month.name}</h1>`
      for (let i = 1; i <= month.total; i++) {
        html += `<th class="text-center">${i}</th>`
        let check = 0
        for (let j = 0; j < acupunctures.length; j++) {
          const { date } = acupunctures[j];
          if (String(date) === String(i)) {
            acupuncture += `<td><span class="badge badge-center rounded-pill bg-success">v</span></td>`
            break;
          }
          check++;
          if (check == acupunctures.length) {

            if (i >= acupunctures[acupunctures.length - 1].date) {
              acupuncture += `<td></td>`
            }
            else {
              acupuncture += `<td><span class="badge badge-center rounded-pill bg-danger">x</span></td>`
            }
          }
        }
      }


      //Hiển thị danh sách tháng trên select
      var monthsHTML = ''
      for (const month of months) {
        monthsHTML += `<option value =${month._id}>Tháng ${month.name}</option>`
      }

      $('#months').html(monthsHTML)
      $("#title_month").html(html)
      $("#acupuncture_user").append(acupuncture)
      $('#card').prepend(h1)



      //event change select
      var user_encode = `{{ users }}`
      var user = JSON.parse(user_encode.replace(/&quot;/ig, '"'));
      $('#months').on('change', function () {
        socket.emit("user-report", { user: user, value: this.value })
      });
    }

  </script>