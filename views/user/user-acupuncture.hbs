<!-- Content wrapper -->
<div class="content-wrapper">
  <!-- Content -->

  <div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-1 mb-3"><span class="text-muted fw-light">Chấm công /</span> Báo cáo chấm công</h4>

    <nav class="navbar bg-light mb-2">
      <div class="container-fluid">
        <input type="hidden" id="table_id" name="table_id" value={{table_id}} />
        <input type="hidden" id="user_id" name="user_id" value={{user._id}} />
        <button id="acupuncture" class="btn btn-danger">Chấm công</button>
      </div>
    </nav>
    <!-- Responsive Table -->
    <div id="card" class="card">
      <div class="table-responsive text-nowrap">
        <table  class="table">
          <thead>
            <tr id="title_month" class="text-nowrap">
            </tr>
          </thead>
          <tbody>
            <tr id="acupuncture_user">
              <td>{{employee.code}}</td>
              <td>{{employee.name}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!--/ Responsive Table -->

  <!--/ Basic Pagination -->
  </div>
  <!-- / Content -->

  <!-- Modal HTML -->
<div id="myModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header">
                <div class="icon-box">
                    <i class='bx bx-check'></i>
                </div>
                <h4 class="modal-title w-100">Đã chấm công</h4>
            </div>
            <div class="modal-body">
                <p class="text-center"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-block" id="data-dismiss">OK</button>
            </div>
        </div>
    </div>
</div>
</div>
<!-- Content wrapper -->
<script>

  var html = "<th>Mã nhân viên</th><th>Tên nhân viên</th>"
  var acupuncture = "";
  var month_encode = "{{ month }}"
  var acupunctures_encode = "{{ acupunctures }}"
  var month = JSON.parse(month_encode.replace(/&quot;/ig, '"'));
  var acupunctures = JSON.parse(acupunctures_encode.replace(/&quot;/ig, '"'));
  var h1 =`<h1 class="text-center mt-5 mb-4">${month.name}</h1>`
  for (let i = 1; i <= month.total; i++) {
    html += `<th>${i}</th>`
    let check = 0
    for (let j = 0; j < acupunctures.length; j++) {
      const { date } = acupunctures[j];
      if (String(date) === String(i)) {
        acupuncture += `<td>1</td>`
        break;
      }
      check++;
      if (check == acupunctures.length) {
        acupuncture += `<td></td>`
      }
    }
  }

  $("#title_month").html(html)
  $("#acupuncture_user").append(acupuncture)
  $('#card').prepend(h1)



  $('#acupuncture').click(function () {

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const { coords } = position
        const { latitude, longitude } = coords
        socket.emit("user-acupuncture", {
          latitude: latitude,
          longitude: longitude,
          table_id: $('#table_id').val(),
          user_id: $('#user_id').val()
        })
      });

    }

  });
</script>